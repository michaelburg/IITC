<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
  </head>
  <body>
    <script>
      // Function to display the grid using an alert
      function displayGrid(sub_message, grid) {
        let message = "";
        for (let row of grid) {
          message += row.join(" | ") + "\n";
          message += "---------\n";
        }
        message += sub_message;
        return message;
      }
      // Example usage
      function get_index(input) {
        let row = parseInt(input / 3);
        if (input % 3 == 0) {
          row--;
        }
        let column;
        if (input % 3 == 0) {
          column = 2;
        } else {
          column = (input % 3) - 1;
        }
        return [row, column];
      }

      function is_input_in_range(input) {
        return input > 0 && input < 10;
      }

      function is_input_taken(grid, row, column) {
        return grid[row][column] == "X" || grid[row][column] == "O";
      }

      function check_win(grid, row, column) {
        if (grid[row][0] == grid[row][1] && grid[row][0] == grid[row][2]) {
          //check row
          return true;
        }
        if (
          grid[0][column] == grid[1][column] &&
          grid[0][column] == grid[2][column]
        ) {
          //check column
          return true;
        }
        if (row == column) {
          //check left ro right
          if (grid[0][0] == grid[1][1] && grid[0][0] == grid[2][2]) {
            return true;
          }
        }
        if (grid[2][0] == grid[1][1] && grid[2][0] == grid[0][2]) {
          //check right ro left
          return true;
        }
        return false;
      }

      function get_user_input(grid) {
        while (true) {
          //get chosen sell from use
          input = parseInt(prompt(message));
          if (isNaN(input)) {
            //is input is number
            invalid_input_message = "invalid input";
            message = displayGrid(invalid_input_message, grid);
          } else if (!is_input_in_range(input)) {
            //is input in range(1-9)
            not_in_range_message = "input not in range";
            message = displayGrid(not_in_range_message, grid);
          } else {
            index = get_index(input); //convert input to cell
            taken_message = index;
            row = index[0];
            column = index[1];
            if (is_input_taken(grid, row, column)) {
              //is cell free
              taken_message = "cell already taken";
              message = displayGrid(taken_message, grid);
            } else {
              grid[row][column] = turn;
              break;
            }
          }
        }
      }

      function new_grid() {
        return [
          ["1", "2", "3"],
          ["4", "5", "6"],
          ["7", "8", "9"],
        ];
      }

      function get_player_name(player) {
        while (true) {
          player_input = prompt(`${player} player name: `);
          if (player_input != "") {
            return player_input;
          }
        }
      }

      function new_game() {
        const grid = new_grid();
        for (let i = 0; i < 9; i++) {
          if (i % 2 == 0) {
            turn = "X";
          } else {
            turn = "O";
          }
          new_turn_message = `it's ${turn} turn, good luck!`;
          message = displayGrid(new_turn_message, grid);
          get_user_input(grid);
          if (i > 3) {
            if (check_win(grid, row, column)) {
              win_message = `${turn} has won`;
              message = displayGrid(win_message, grid);
              alert(message);
              return turn;
            }
          }
        }
        tie_message = "its a tie";
        message = displayGrid(tie_message, grid);
        alert(message);
        return "tie";
      }

      function stat_game() {
        let stat = {};
        while (true) {
          X_player = get_player_name("X");
          O_player = get_player_name("O");

          if (!(X_player in stat)) {
            stat[X_player] = {};
            stat[X_player]["win"] = 0;
            stat[X_player]["lose"] = 0;
            stat[X_player]["tie"] = 0;
          }
          if (!(O_player in stat)) {
            stat[O_player] = {};
            stat[O_player]["win"] = 0;
            stat[O_player]["lose"] = 0;
            stat[O_player]["tie"] = 0;
          }

          resault = new_game();
          if (resault == "X") {
            stat[X_player]["win"]++;
            stat[O_player]["lose"]++;
          } else if (resault == "O") {
            stat[O_player]["win"]++;
            stat[X_player]["lose"]++;
          } else {
            stat[O_player]["tie"]++;
            stat[X_player]["tie"]++;
          }
          let message = "";
          for (const player in stat) {
            message += player;
            message += ": ";
            for (const property in stat[player]) {
              message += property;
              message += ": ";
              message += stat[player][property];
              message += ", ";
            }
            message += "\n";
          }
          alert(message);
        }
      }
      stat_game();
    </script>
  </body>
</html>
